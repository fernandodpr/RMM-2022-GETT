[general]


[phones]

exten => _X.,1,Playback(invalid)
exten => i,1,Playback(invalid) ; Invalid

exten => _1XX,1,NoOp(Comprobando estado DND del usuario)
same => n,Set(DND=${DB(DEVICE/${EXTEN}/dnd)})
same => n,GotoIf($["${DND}" = "YES"]?dnd_on:dial_extension)

; Si el DND está activado, salta al paso de mensaje DND y voicemail
same => n(dnd_on),Playback(do-not-disturb)
same => n,Goto(voicemail)

; Si el DND no está activado, intenta la llamada durante 8 segundos
same => n(dial_extension),Dial(PJSIP/${EXTEN},8,m(default))

; Si la llamada no es contestada,la extensión está ocupada o DND salta al buzón de voz correspondiente
same => n(voicemail),VoiceMail(${EXTEN}@default,u)
same => n,Hangup()


exten => 900,1,Goto(menu,s,1)

exten=>600,1,Goto(funcionalidades,echo,1)
exten=>601,1,Goto(funcionalidades,DND,1)
exten=>602,1,Goto(funcionalidades,onhold,1)
exten=>603,1,Goto(funcionalidades,voicemail,1)
exten=>604,1,Goto(funcionalidades,IPSRV,1)
exten=>605,1,GoTo(avanzadas,servicio,1)

;IVR
[menu]
exten => s,1,Answer() ; Contestar la llamada
same => n,Background(custom/Bienvenida) ; Reproducir mensaje de bienvenida
same => n,(loop),Background(dtmf_menu,custom/Opciones);
same => n,WaitExten(5);Esperamos durante 5 segundos

exten => 1,1,VoiceMailMain(${CALLERID(num)}) ; Acceder al buzón de voz del usuario
exten => 2,1,GoTo(funcionalidades,DND,1)
exten => 3,1,GoTo(funcionalidades,IPSRV,1)
exten => 4,1,GoTo(avanzadas,servicio,1)

exten => i,1,Playback(invalid) ; Invalid
exten => t,1 Playback(timeout) ; Timeout

[funcionalidades]

;Prueba de echo
exten => echo,1,Answer()
same => n,Playback(demo-echotest)
same => n,Echo
same => n,Playback(demo-echodone)
same => n,Hangup

;Extension para probar la musica de espera
exten => onhold,1,Answer()
same => n,Set(CHANNEL(musicclass)=default) ; establece la clase de música de fondo
same => n,MusicOnHold() ; reproduce la música de fondo en bucle
same => n,Hangup()

;Servicio no molestar
exten => DND,1,Answer()
same => n,NoOp(Extension 602 DND control)
same => n,Set(DND=${DB(DEVICE/${CALLERID(num)}/dnd)})
same => n,Playback(do-not-disturb)
same => n,GotoIf($["${DND}" = "YES"]?disable_dnd:enable_dnd)
; enable DND
same => n(enable_dnd),Set(DB(DEVICE/${CALLERID(num)}/dnd)=YES)
same => n,Playback(enabled)
same => n,Hangup()
; disable DND
same => n(disable_dnd),Set(DB(DEVICE/${CALLERID(num)}/dnd)=NO)
same => n,Playback(disabled)
same => n,Hangup()

exten => IPSRV,1,Answer()
same => n,Set(via=${PJSIP_HEADER(read,Via)})

same=>n,Set(aux=${CUT(via,\;,3)})
same=>n,Set(ip=${CUT(aux,=,2)})
same => n,Playback(address)
same => n,SayAlpha(${ip})

same=>n,Set(aux=${CUT(via,\;,2)})
same=>n,Set(port=${CUT(aux,=,2)})
same => n,Playback(port)
same => n,SayAlpha(${port})

same => n,Hangup()

; Extension para consultar el correo de voz
exten => voicemail,1,Answer()
same => n,Wait(1)
same => n,VoiceMailMain()
same => n,Hangup()

[avanzadas]
exten => servicio,1,Answer()

same=>n,set(HTTP=${CURL(https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/eur/usd.json)})
same=>n,Set(aux=${CUT(HTTP,\,,2)})
same=>n,Set(usdrate=${CUT(aux,:,2)})


same => n,Verbose(0, "El valor de usd es: ${usdrate}")
same => n,Playback(press-1)
same => n,Playback(for)
same => n,Playback(euro)
same => n,SayAlpha(a)
same => n,SayAlpha($)
same => n,Playback(press-2)
same => n,Playback(for)
same => n,SayAlpha($)
same => n,SayAlpha(a)
same => n,Playback(euro)


same => n,WaitExten(5);Esperamos durante 5 segundos

exten => 1,1,NoOp(Conversion de euro a dolar)
same => n,Playback(please-enter-the)
same => n,Playback(euro)
same => n,Read(euros,beep,5,,2)
same => n,Set(res=${MATH(${euros}*${usdrate})})
same => n,SayNumber(${res})
same => n,SayAlpha(${res})
same => n,SayDigits(${res})






exten => 2,1,NoOp(Conversion de dolar a euro)
same => n,Playback(please-enter-the)
same => n,SayAlpha($)
same => n,Read(dollar,beep,5,,2)
same => n,Set(res=${MATH(${dollar}*${usdrate})})
same => n,SayAlpha(${res})


same => n,Hangup()








; Hay que hacer que diga la tasa de cambio antes de nada
; Si pulsa uno de euro a USD
; Si pulsa dos de USD a euro
; Pedir que introduzca la cantidad de euros/dolares y pulse #
; Hacer la multlicacion
; Decir el resultado
;   
